# üë§ –°–æ–∑–¥–∞–Ω–∏–µ –ê–¥–º–∏–Ω –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Supabase

> **–ó–∞–¥–∞—á–∞:** AIL-239 - –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

---

## üìã –û–±–∑–æ—Ä

–°–æ–∑–¥–∞–¥–∏–º –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å email `admin@aironlab.ru` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~3 –º–∏–Ω—É—Ç—ã

---

## üöÄ –ú–µ—Ç–æ–¥ 1: –ß–µ—Ä–µ–∑ Supabase Dashboard (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ Authentication

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [https://supabase.com/dashboard](https://supabase.com/dashboard)
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç **AIronLab Production**
3. –í –ª–µ–≤–æ–º –º–µ–Ω—é: **Authentication** ‚Üí **Users**

### –®–∞–≥ 2: –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"Add user"** (–∏–ª–∏ **"Invite"**)
2. –í—ã–±–µ—Ä–∏—Ç–µ **"Create new user"**

### –®–∞–≥ 3: –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ

```
Email: admin@aironlab.ru
Password: [–°–æ–∑–¥–∞–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å]
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–∞—Ä–æ–ª—è:**
- –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
- –ë—É–∫–≤—ã –≤–µ—Ä—Ö–Ω–µ–≥–æ –∏ –Ω–∏–∂–Ω–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞
- –¶–∏—Ñ—Ä—ã
- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã

**–ü—Ä–∏–º–µ—Ä –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è:**
```
Aironlab2025!Admin
```

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –≤ –Ω–∞–¥–µ–∂–Ω–æ–º –º–µ—Å—Ç–µ (1Password, LastPass –∏ —Ç.–¥.)

### –®–∞–≥ 4: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —É –≤–∞—Å –≤–∫–ª—é—á–µ–Ω–∞ email verification:

**–í–∞—Ä–∏–∞–Ω—Ç A: –û—Ç–∫–ª—é—á–∏—Ç—å email verification (–¥–ª—è dev)**
1. **Authentication** ‚Üí **Settings**
2. **Email Auth** ‚Üí –û—Ç–∫–ª—é—á–∏—Ç–µ **"Enable email confirmations"**
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Å—Ä–∞–∑—É –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—ã–π

**–í–∞—Ä–∏–∞–Ω—Ç B: –í—Ä—É—á–Ω—É—é –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å email**
1. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–π–¥–∏—Ç–µ –µ–≥–æ –≤ —Å–ø–∏—Å–∫–µ
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ email
3. –í –¥–µ—Ç–∞–ª—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: **"Confirm email"**

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –í —Å–ø–∏—Å–∫–µ Users –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è `admin@aironlab.ru`
2. –°—Ç–∞—Ç—É—Å: **"Confirmed"** (–∑–µ–ª–µ–Ω—ã–π)
3. –ó–∞–ø–æ–º–Ω–∏—Ç–µ **User ID** (UUID) - –æ–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø–æ–∑–∂–µ

---

## üîê –ú–µ—Ç–æ–¥ 2: –ß–µ—Ä–µ–∑ SQL (–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ:

### –ß–µ—Ä–µ–∑ SQL Editor

```sql
-- –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
-- –ó–∞–º–µ–Ω–∏—Ç–µ 'your-secure-password' –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å
INSERT INTO auth.users (
  instance_id,
  id,
  aud,
  role,
  email,
  encrypted_password,
  email_confirmed_at,
  created_at,
  updated_at,
  raw_app_meta_data,
  raw_user_meta_data,
  is_super_admin,
  confirmation_token,
  recovery_token
)
VALUES (
  '00000000-0000-0000-0000-000000000000',
  gen_random_uuid(),
  'authenticated',
  'authenticated',
  'admin@aironlab.ru',
  crypt('your-secure-password', gen_salt('bf')), -- –ó–∞–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å!
  NOW(),
  NOW(),
  NOW(),
  '{"provider":"email","providers":["email"]}',
  '{"name":"AIronLab Admin"}',
  false,
  '',
  ''
);
```

‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —Å–ª–æ–∂–Ω–µ–µ –∏ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–∞–º. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ú–µ—Ç–æ–¥ 1 (Dashboard).

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: User —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT 
  id,
  email,
  email_confirmed_at,
  created_at,
  raw_user_meta_data
FROM auth.users
WHERE email = 'admin@aironlab.ru';
```

–î–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å—Å—è –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ —Å –≤–∞—à–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –¢–µ—Å—Ç–æ–≤—ã–π –ª–æ–≥–∏–Ω

**–ß–µ—Ä–µ–∑ Supabase JS (–≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ Node.js):**

```javascript
import { createClient } from '@supabase/supabase-js'

const supabase = createClient(
  'YOUR_SUPABASE_URL',
  'YOUR_SUPABASE_ANON_KEY'
)

const { data, error } = await supabase.auth.signInWithPassword({
  email: 'admin@aironlab.ru',
  password: 'your-password'
})

if (error) {
  console.error('Login failed:', error.message)
} else {
  console.log('‚úÖ Login successful!', data.user.email)
}
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∞–¥–º–∏–Ω–∫–µ:

```sql
-- –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
UPDATE auth.users
SET raw_user_meta_data = jsonb_set(
  raw_user_meta_data,
  '{name}',
  '"AIronLab Admin"'
)
WHERE email = 'admin@aironlab.ru';

-- –î–æ–±–∞–≤–∏—Ç—å —Ä–æ–ª—å (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
UPDATE auth.users
SET raw_app_meta_data = jsonb_set(
  raw_app_meta_data,
  '{role}',
  '"admin"'
)
WHERE email = 'admin@aironlab.ru';
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

```sql
SELECT 
  email,
  raw_user_meta_data->>'name' as name,
  raw_app_meta_data->>'role' as role
FROM auth.users
WHERE email = 'admin@aironlab.ru';
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```
email                 | name            | role
----------------------|-----------------|-------
admin@aironlab.ru     | AIronLab Admin  | admin
```

---

## üë• –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∞–¥–º–∏–Ω–æ–≤ (–≤ –±—É–¥—É—â–µ–º)

### –ß–µ—Ä–µ–∑ Dashboard
–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ú–µ—Ç–æ–¥ 1 —Å –¥—Ä—É–≥–∏–º email (–Ω–∞–ø—Ä–∏–º–µ—Ä, `sasha@aironlab.ru`)

### –ß–µ—Ä–µ–∑ SQL
```sql
-- –ü—Ä–∏–º–µ—Ä –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ –∞–¥–º–∏–Ω–∞
INSERT INTO auth.users (...)
VALUES (..., 'sasha@aironlab.ru', ...);
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### ‚úÖ –ß—Ç–æ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

- RLS policies —Ä–∞–∑—Ä–µ—à–∞—é—Ç –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ authenticated users
- Email/Password authentication –≤–∫–ª—é—á–µ–Ω
- –ü–∞—Ä–æ–ª–∏ —Ö—ç—à–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ bcrypt

### üîÑ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

#### 1. –í–∫–ª—é—á–∏—Ç—å 2FA (Two-Factor Authentication)
```
Authentication ‚Üí Settings ‚Üí Enable MFA
```

#### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Email Templates
```
Authentication ‚Üí Email Templates
```
–ö–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∏—Å—å–º–∞:
- Confirmation email
- Reset password
- Magic link

#### 3. Session Duration
```
Authentication ‚Üí Settings ‚Üí Session Duration
```
–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 7 –¥–Ω–µ–π (604800 —Å–µ–∫—É–Ω–¥)

#### 4. Password Requirements
```
Authentication ‚Üí Settings ‚Üí Password Requirements
```
- Minimum length: 8
- Require uppercase
- Require numbers
- Require special characters

---

## üÜò Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "User already exists"

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –£–¥–∞–ª–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
DELETE FROM auth.users WHERE email = 'admin@aironlab.ru';

-- –°–æ–∑–¥–∞—Ç—å –∑–∞–Ω–æ–≤–æ
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Email not confirmed"

**–†–µ—à–µ–Ω–∏–µ A (—á–µ—Ä–µ–∑ UI):**
1. Users ‚Üí –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ù–∞–∂–∞—Ç—å –Ω–∞ email ‚Üí **"Confirm email"**

**–†–µ—à–µ–Ω–∏–µ B (—á–µ—Ä–µ–∑ SQL):**
```sql
UPDATE auth.users
SET email_confirmed_at = NOW()
WHERE email = 'admin@aironlab.ru';
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid login credentials"

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å
2. Email –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT 
  email,
  email_confirmed_at,
  banned_until,
  deleted_at
FROM auth.users
WHERE email = 'admin@aironlab.ru';
```

### –ü—Ä–æ–±–ª–µ–º–∞: "User is banned"

**–†–µ—à–µ–Ω–∏–µ:**
```sql
UPDATE auth.users
SET banned_until = NULL
WHERE email = 'admin@aironlab.ru';
```

---

## üìù –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ credentials

### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` (—É–∂–µ –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å):

```bash
# Admin credentials (–ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—å –≤ git!)
ADMIN_EMAIL=admin@aironlab.ru
ADMIN_PASSWORD=your-password-here
```

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `.env.local` –≤ `.gitignore`!

### –î–ª—è production

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞—Ä–æ–ª–µ–π:
- 1Password
- LastPass
- Bitwarden
- Keepass

**–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤:**
- Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- –ù–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- Slack/Telegram —Å–æ–æ–±—â–µ–Ω–∏—è
- Email

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
2. ‚è≠Ô∏è –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å TypeScript types (—Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å AIL-239)
3. ‚è≠Ô∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Supabase –∫–ª–∏–µ–Ω—Ç—ã –≤ frontend
4. ‚è≠Ô∏è –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞ (AIL-241)

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Supabase Auth Documentation](https://supabase.com/docs/guides/auth)
- [Managing Users](https://supabase.com/docs/guides/auth/managing-user-data)
- [Row Level Security](https://supabase.com/docs/guides/auth/row-level-security)

---

**–ó–∞–¥–∞—á–∞:** AIL-239 (—á–∞—Å—Ç—å 1/3)  
**–°–æ–∑–¥–∞–Ω–æ:** 2025-10-21  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~3 –º–∏–Ω—É—Ç—ã

