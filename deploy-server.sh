#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Ä–µ–≥.—Ä—É
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./deploy-server.sh

set -e

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Ä–µ–≥.—Ä—É..."

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥ –≤–∞—à —Å–µ—Ä–≤–µ—Ä)
SERVER_USER="your_username"           # –í–∞—à –ª–æ–≥–∏–Ω SSH
SERVER_HOST="your_server.hosting.reg.ru" # –•–æ—Å—Ç —Å–µ—Ä–≤–µ—Ä–∞
SERVER_PATH="/home/your_username/public_html" # –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å–∞–π—Ç–∞
REPO_URL="https://github.com/Santino42-gr/AIronLab---Frontend.git"

echo "üì° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É..."

# –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
SSH_COMMANDS="
cd $SERVER_PATH &&
echo 'üì• –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –∏–∑ GitHub...' &&
git pull origin main &&
echo 'üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...' &&
npm ci &&
echo 'üî® –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è —Ö–æ—Å—Ç–∏–Ω–≥–∞...' &&
NEXT_PUBLIC_DEPLOY_TARGET=hosting npm run build &&
echo 'üìÅ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ –∫–æ—Ä–µ–Ω—å —Å–∞–π—Ç–∞...' &&
cp -r out/* . &&
echo 'üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤...' &&
rm -rf out .next node_modules &&
echo '‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!'
"

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh "$SERVER_USER@$SERVER_HOST" "$SSH_COMMANDS"

echo "üéâ –°–∞–π—Ç –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ https://aironlab.ru" 